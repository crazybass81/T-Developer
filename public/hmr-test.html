<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¥ HMR í…ŒìŠ¤íŠ¸ í˜ì´ì§€</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .status {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 500;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .connected {
            background: rgba(40, 167, 69, 0.8);
            border: 2px solid #28a745;
        }
        
        .disconnected {
            background: rgba(220, 53, 69, 0.8);
            border: 2px solid #dc3545;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .info-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .info-card h3 {
            margin-top: 0;
            color: #ffd700;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s ease;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .timestamp {
            color: #ffd700;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¥ Hot Module Replacement í…ŒìŠ¤íŠ¸</h1>
        
        <div id="status" class="status disconnected">
            HMR WebSocket ì—°ê²° ì¤‘...
        </div>
        
        <div class="info-grid">
            <div class="info-card">
                <h3>ğŸ“Š ì—°ê²° ì •ë³´</h3>
                <p><strong>WebSocket URL:</strong> ws://localhost:3001</p>
                <p><strong>í˜„ì¬ ì‹œê°„:</strong> <span id="time"></span></p>
                <p><strong>í˜ì´ì§€ ë¡œë“œ:</strong> <span id="loadTime"></span></p>
            </div>
            
            <div class="info-card">
                <h3>ğŸ”„ HMR ìƒíƒœ</h3>
                <p><strong>ì—°ê²° ìƒíƒœ:</strong> <span id="connectionStatus">ì—°ê²° ì¤‘...</span></p>
                <p><strong>ì¬ì—°ê²° íšŸìˆ˜:</strong> <span id="reconnectCount">0</span></p>
                <p><strong>ë§ˆì§€ë§‰ ì´ë²¤íŠ¸:</strong> <span id="lastEvent">ì—†ìŒ</span></p>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥</h3>
            <p>ë‹¤ìŒ ê¸°ëŠ¥ë“¤ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”:</p>
            <button onclick="testReload()">ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨</button>
            <button onclick="testWebSocket()">WebSocket í…ŒìŠ¤íŠ¸</button>
            <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
            
            <div class="log" id="log">
                <div class="timestamp">[ì‹œì‘]</div> HMR í…ŒìŠ¤íŠ¸ í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“ HMR í…ŒìŠ¤íŠ¸ ë°©ë²•</h3>
            <ol>
                <li><strong>íŒŒì¼ ìˆ˜ì •:</strong> backend/src í´ë”ì˜ TypeScript íŒŒì¼ì„ ìˆ˜ì •í•˜ì„¸ìš”</li>
                <li><strong>ìë™ ê°ì§€:</strong> Chokidarê°€ íŒŒì¼ ë³€ê²½ì„ ê°ì§€í•©ë‹ˆë‹¤</li>
                <li><strong>í•« ë¦¬ë¡œë“œ:</strong> ë³€ê²½ëœ ëª¨ë“ˆì´ ìë™ìœ¼ë¡œ ë¦¬ë¡œë“œë©ë‹ˆë‹¤</li>
                <li><strong>ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨:</strong> WebSocketì„ í†µí•´ ë¸Œë¼ìš°ì €ê°€ ìƒˆë¡œê³ ì¹¨ë©ë‹ˆë‹¤</li>
            </ol>
        </div>
    </div>

    <script>
        let ws;
        let reconnectCount = 0;
        let isConnected = false;
        
        function updateTime() {
            document.getElementById('time').textContent = new Date().toLocaleString();
        }
        
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `<br><span class="timestamp">[${timestamp}]</span> ${message}`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function connectWebSocket() {
            ws = new WebSocket('ws://localhost:3001');
            
            ws.onopen = () => {
                isConnected = true;
                document.getElementById('status').className = 'status connected';
                document.getElementById('status').textContent = 'ğŸŸ¢ HMR WebSocket ì—°ê²°ë¨';
                document.getElementById('connectionStatus').textContent = 'ì—°ê²°ë¨';
                log('WebSocket ì—°ê²° ì„±ê³µ');
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                document.getElementById('lastEvent').textContent = data.action;
                
                switch (data.action) {
                    case 'reload':
                        log('ğŸ”„ íŒŒì¼ ë³€ê²½ ê°ì§€ - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
                        setTimeout(() => {
                            window.location.reload();
                        }, 500);
                        break;
                        
                    case 'restart':
                        log('ğŸ”„ ì„œë²„ ì¬ì‹œì‘ ê°ì§€ - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                        break;
                        
                    case 'css':
                        log('ğŸ¨ CSS ì—…ë°ì´íŠ¸');
                        updateCSS(data.file);
                        break;
                        
                    default:
                        log(`ğŸ“¨ ì•Œ ìˆ˜ ì—†ëŠ” ì´ë²¤íŠ¸: ${data.action}`);
                }
            };
            
            ws.onclose = () => {
                isConnected = false;
                document.getElementById('status').className = 'status disconnected';
                document.getElementById('status').textContent = 'ğŸ”´ HMR WebSocket ì—°ê²° ëŠê¹€';
                document.getElementById('connectionStatus').textContent = 'ì—°ê²° ëŠê¹€';
                log('WebSocket ì—°ê²° ëŠê¹€ - ì¬ì—°ê²° ì‹œë„ ì¤‘...');
                
                // ì¬ì—°ê²° ì‹œë„
                setTimeout(() => {
                    reconnectCount++;
                    document.getElementById('reconnectCount').textContent = reconnectCount;
                    connectWebSocket();
                }, 2000);
            };
            
            ws.onerror = (error) => {
                log(`âŒ WebSocket ì˜¤ë¥˜: ${error.message || 'ì—°ê²° ì‹¤íŒ¨'}`);
            };
        }
        
        function updateCSS(file) {
            const links = document.querySelectorAll('link[rel="stylesheet"]');
            const link = Array.from(links).find(l => l.href.includes(file));
            
            if (link) {
                const newLink = link.cloneNode();
                newLink.href = link.href.split('?')[0] + '?t=' + Date.now();
                link.parentNode.replaceChild(newLink, link);
                log(`ğŸ¨ CSS íŒŒì¼ ì—…ë°ì´íŠ¸: ${file}`);
            }
        }
        
        function testReload() {
            log('ğŸ§ª ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ í…ŒìŠ¤íŠ¸');
            window.location.reload();
        }
        
        function testWebSocket() {
            if (isConnected) {
                log('ğŸ§ª WebSocket ì—°ê²° í…ŒìŠ¤íŠ¸ - ì—°ê²°ë¨');
            } else {
                log('ğŸ§ª WebSocket ì—°ê²° í…ŒìŠ¤íŠ¸ - ì—°ê²° ì•ˆë¨');
                connectWebSocket();
            }
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '<div class="timestamp">[ì§€ì›€]</div> ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.';
        }
        
        // ì´ˆê¸°í™”
        document.getElementById('loadTime').textContent = new Date().toLocaleString();
        updateTime();
        setInterval(updateTime, 1000);
        connectWebSocket();
    </script>
</body>
</html>